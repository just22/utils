#!/bin/sh

# ----------------------------------------------------------------------
#  $Id$
#
#  Switches to selected window (searching for its class and/or title)
#  Dependencies: dmenu, wmctrl
# ----------------------------------------------------------------------

search_win() {
        for WIN_ID in $(xprop -root _NET_CLIENT_LIST |
                        egrep -o "0x[0-9a-fA-F]+")
        do
                xprop -id "$WIN_ID" _NET_WM_WINDOW_TYPE WM_CLASS WM_NAME |
                awk -v id="$WIN_ID" '
                        /^_NET_WM_WINDOW_TYPE/  {if (match($0, "DOCK|DESKTOP")) {exit}}
                        /^WM_CLASS/             {c = $4}
                        /^WM_NAME/              {t = ""; for(i = 3; i <= NF; ++i) t = (t $i)}
                        END                     {printf("%s %s %s\n", id, c, t)}'

        done |
        dmenu-cust -p Win: -i -l 5 | cut -d " " -f 1
}

wmctrl -i -a $(search_win)
