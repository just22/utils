#!/bin/sh

# ----------------------------------------------------------------------
#  $Id$
#
#  Battery status monitor - Intended for use with cron
# ----------------------------------------------------------------------

if [ "$(apm -a)" -eq 0 ]; then
        lt="$(apm -m)"
        if [ "$lt" -le 5 ]; then
                msg="Critical battery level, hibernating in 30s..."

                logger -t check-batt-status "$msg"

                echo "$msg" | DISPLAY=$(cat /tmp/X_DISPLAY.$USER) \
                                xmessage -title "Low battery" -center -buttons "OK":0 -timeout 30 -file -

                # Check once again if power supply has been connected;
                # if not, hibernate the machine
                [ "$(apm -a)" -eq 0 ] && apm -Z

        elif [ "$lt" -le 15 ]; then
                msg="Low battery level (lifetime: ${lt}m)"

                logger -t check-batt-status "$msg"

                echo "$msg" | DISPLAY=$(cat /tmp/X_DISPLAY.$USER) \
                                xmessage -title "Low battery" -center -buttons "OK":0,"Hibernate":2 -timeout 60 -file -

                [ "$?" -eq 2 ] && apm -Z
        fi
fi
