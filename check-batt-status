#!/bin/sh

# ----------------------------------------------------------------------
#  $Id$
#
#  Battery status monitor - Intended for use with cron
#  (needs operator's privileges at minimum, typically run as root)
# ----------------------------------------------------------------------

# If A/C adapter is connected, just exit
[ "$(apm -a)" -eq 0 ] || exit

ble="$(apm -m)"

# If estimated battery life is > 15', just exit
[ "$ble" -gt 15 ] && exit

# Battery level is critical, let's warn all logged users
alias logger='logger -t $(basename $0) -p daemon.crit'
msg="$(apm -m -v)"
echo $msg | logger
echo $msg | wall
pkill -USR1 -fl x-batt-warn

[ "$ble" -gt 10 ] && exit

# Imminent disaster, force suspend to disk
sleep 180
[ "$(apm -a)" -eq 0 ] || exit
apm -Z

