#!/bin/sh

BATT_LIFE_PERC=$(apm -l)
case "$(sysctl -n hw.sensors.acpibat0.raw0 | awk '{print $1}')" in
    1)
        BATT_LIFE_TIME=$(apm -m | awk '{printf "%1d:%02d", int($1/60), $1%60}')
        if [ "$BATT_LIFE_PERC" -ge 65 ]; then
                BATT_ICON="<img>/home/just22/.local/share/icons/stlarch_icons/batt5full.xbm</img>"
        elif [ "$BATT_LIFE_PERC" -le 15 ]; then
                BATT_ICON="<img>/home/just22/.local/share/icons/stlarch_icons/batt5empty.xbm</img>"
        else
                BATT_ICON="<img>/home/just22/.local/share/icons/stlarch_icons/batt5half.xbm</img>"
        fi
        ;;
    2)
        BATT_LIFE_TIME="-:--"
        BATT_ICON="<img>/home/just22/.local/share/icons/stlarch_icons/ac15.xbm</img>"
        ;;
    *)
        BATT_LIFE_TIME="-:--"
        BATT_ICON="<img>/home/just22/.local/share/icons/stlarch_icons/ac15.xbm</img>"
        # Temporary (waiting for a "nobatt" icon...)
        #BATT_ICON="<img>/home/just22/.local/share/icons/stlarch_icons/error1.xbm</img>"
        ;;
esac
printf "%s<txt> %d%% %4s </txt><tool></tool>" "$BATT_ICON" "$BATT_LIFE_PERC" "$BATT_LIFE_TIME"
