#!/bin/sh

# ----------------------------------------------------------------------
#  $Id$
#
#  Logout from current session (or suspend/reboot/poweroff the machine)
#  using Xdialog
# ----------------------------------------------------------------------

echo $XSESSION_CMD
DIALOG=Xdialog

$DIALOG --title "Session logout" \
        --radiolist "Please select an action:" 18 50 0 \
                "Logout"        "Exit from current X session"   off \
                "Suspend"       "Suspend to RAM"                off \
                "Hibernate"     "Suspend to disk"               ON  \
                "Reboot"        "Reboot the system"             off \
                "Poweroff"      "Shut down the computer"        off \
        2>/tmp/checklist.tmp.$$

RETVAL=$?
CHOICE=`cat /tmp/checklist.tmp.$$`
rm -f /tmp/checklist.tmp.$$

if [ $RETVAL -eq 0 ]; then
        case "$CHOICE" in
        Logout)
                # Next login should start from a known display configuration...
                case "$(xrandr -q | grep -E "[0-9]+x[0-9]+\+[0-9]+\+[0-9]+" | head -n 1 | cut -d" " -f1)" in
                LVDS*) dmenu-xrandr -d Off ;;
                VGA*)  dmenu-xrandr -d Only ;;
                esac

                case "$XSESSION_CMD" in
                *fluxbox*)
                        pkill -P "$(cat /tmp/dbar.pid)"
                        rm /tmp/dbar.pid
                        fluxbox-remote Exit
                        ;;
                *xfce*)
                        xfce4-session-logout --logout --fast
                        ;;
                cwm|twm)
                        pkill "$XSESSION_CMD"
                        ;;
                *openbox*)
                        openbox --exit
                        ;;
                esac
                ;;
        Suspend)
                /usr/sbin/zzz
                ;;
        Hibernate)
                /usr/sbin/ZZZ
                ;;
        Reboot)
                /usr/bin/doas /sbin/reboot
                ;;
        Poweroff)
                /usr/bin/doas /sbin/shutdown -p now
                ;;
        esac
fi
